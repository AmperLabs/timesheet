@page "/bunkai"
@using Timesheet.Services
@using Timesheet.Entities

@rendermode InteractiveServer

<FluentBreadcrumb>
    <FluentBreadcrumbItem Href="bunkai">
        Bunkai
    </FluentBreadcrumbItem>
</FluentBreadcrumb>

<FluentLabel Typo="Typography.PageTitle">Bunkai Liste</FluentLabel>


<FluentDataGrid Items="@BunkaiList"
                TGridItem="Bunkai"
                HeaderCellAsButtonWithMenu="true">
    <PropertyColumn Title="Kata" Property="@(c => c.KataName)" Sortable="true" />
        <TemplateColumn Sortable="true">
            <a href="bunkai/@context.KataName">@context.KataName</a>
        </TemplateColumn>
</FluentDataGrid>

<FluentButton OnClick="OnAddBunkai" >Add Bunkai</FluentButton>

@code {
    [Inject] IDialogService DialogService { get; set; }

    [Inject]
    public BunkaiService BunkaiService { get; set; }

    private IQueryable<Bunkai>? BunkaiList = null;

    protected override async Task OnParametersSetAsync()
    {
        await LoadBunkaiList();
    }

    private async Task LoadBunkaiList()
    {
        BunkaiList = (await BunkaiService.GetAll()).AsQueryable();
    }

    private async Task OnAddBunkai()
    {
        DialogParameters parameters = new()
        {
            Title = $"Add new Bunkai",
            PrimaryAction = "Save",
            PrimaryActionEnabled = false,
            SecondaryAction = "Cancel",
            Width = "500px",
            TrapFocus = true,
            Modal = true,
            PreventScroll = true
        };

        IDialogReference dialog = await DialogService.ShowDialogAsync<BunkaiEditor>(null, parameters);
        DialogResult? result = await dialog.Result;

        if(!result.Cancelled)
        {
            await LoadBunkaiList();
        }
    }
}
